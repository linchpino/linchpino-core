name: deploy development branch to linchpino-core-dev server

on:
  push:
    branches:
      - setup-conditional-workflow-on-branches

  #workflow_run:
  #  workflows: [ "SonarCloudMaven" ]
  #  types:
  #    - completed

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  Deploy-to-linchpino-core-server:
    runs-on: self-hosted
    permissions:
      contents: read
      packages: write
    steps:
      - name: Connect to linchpino-core on GCP instance
        run: |
          cd ${{ secrets.WORK_DIR }} 
          sudo git branch
          echo $GITHUB_HEAD_REF	
          sudo git checkout $GITHUB_HEAD_REF	
          sudo git branch 
          sudo git pull 
          docker-compose pull 
          docker-compose stop ${{ secrets.SERVICE_NAME }} 
          sleep 2 
          docker-compose rm -f ${{ secrets.SERVICE_NAME }} 
          docker-compose up -d
        
 
